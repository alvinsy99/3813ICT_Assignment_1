<h1>Groups Page</h1>

<div class="wrapper fadeInDown">
  <div id="formContent">
    <!-- Tabs Titles -->

    <form *ngIf="session.isGroupAdmin == true || session.isSuperAdmin == true">
      <input
        type="text"
        id="login"
        class="fadeIn second"
        name="groupname"
        placeholder="Enter new Group name"
        [(ngModel)]="groupname"
        autofocus
        required
      />

      <p>
        Choose Group Admin 1*:<select
          name="assist1"
          [(ngModel)]="assist1"
          required
        >
          <option *ngFor="let user of users" [ngValue]="user.username">{{
            user.username
          }}</option>
        </select>
      </p>

      <p>
        Choose Group Admin 2:<select name="assist2" [(ngModel)]="assist2">
          <option value=""></option>
          <option *ngFor="let user of users" [ngValue]="user.username">{{
            user.username
          }}</option>
        </select>
      </p>

      <input
        type="submit"
        class="fadeIn fourth"
        value="Create Group"
        (click)="createGroup(session.username)"
      />
    </form>
  </div>
</div>

<h2>List of Groups and Members</h2>

<ul>
  <li *ngFor="let group of groups">
    <h2>{{ group.group_name }}</h2>
    <button
      *ngIf="
        group.group_admin == session.username || session.isSuperAdmin == true
      "
      (click)="removeGroup(group.group_name)"
    >
      Remove {{ group.group_name }} group
    </button>

    <!-- Display the add user to group form -->
    <p
      *ngIf="
        group.group_admin == session.username ||
        group.group_assist_1 == session.username ||
        group.group_assist_2 == session.username ||
        session.isSuperAdmin == true
      "
    >
      Add
      <select name="user" [(ngModel)]="selectedUser">
        <option *ngFor="let user of users" [ngValue]="user.username">{{
          user.username
        }}</option>
      </select>
      to {{ group.group_name }}
      <input
        [(ngModel)]="selectedGroup"
        name="selectedGroup"
        [value]="group.group_name"
        hidden
      />

      <button (click)="addMember(group.group_name)">Add</button>
    </p>

    <!-- Display user in group -->
    <ol
      *ngIf="
        session.isSuperAdmin == true ||
        group.group_admin == session.username ||
        group.group_assist_1 == session.username ||
        group.group_assist_2 == session.username ||
        group.members.indexOf(session.username) >= 0
      "
    >
      <li>Group Admin: {{ group.group_admin }}</li>
      <li>Group Assist 1: {{ group.group_assist_1 }}</li>
      <li>Group Assist 2: {{ group.group_assist_2 }}</li>

      <ol>
        <li *ngFor="let member of group.members">
          {{ member }}
          <button
            (click)="removeMember(member, group.group_name)"
            *ngIf="
              (group.group_admin == session.username ||
                group.group_assist_1 == session.username ||
                group.group_assist_2 == session.username ||
                session.isSuperAdmin == true) &&
              member !== session.username
            "
          >
            Remove {{ member }}
          </button>
        </li>
      </ol>
    </ol>

    <ul>
      <li *ngFor="let channel of group.channels">
        <a
          [routerLink]="['/channel', group.group_name, channel.channel_name]"
          *ngIf="channel.channel_members.indexOf(session.username) !== -1"
        >
          {{ channel.channel_name }} ({{ channel.channel_members }})
        </a>
      </li>
    </ul>
    <!-- <p>
      Add {{ selectedUserChannel }} to {{ selectedChannel }} channel
      <br />
      <select name="selectedUserChannel" [(ngModel)]="selectedUserChannel">
        <option *ngFor="let user of group.members" [ngValue]="user">{{
          user
        }}</option>
      </select>
      to
      <select name="selectedChannel" [(ngModel)]="selectedChannel">
        <option *ngFor="let channel of group.channels"
          ><button [routerLink]="['/channels', channel.channel_name]">
            {{ channel.channel_name }}
          </button></option
        >
      </select> -->

    <!-- Button to add user to channel -->
    <!-- <button (click)="addUserToChannel(group.group_name)">
        Add
      </button>
    </p> -->
    <p
      *ngIf="
        group.group_admin == session.username ||
        group.group_assist_1 == session.username ||
        group.group_assist_2 == session.username ||
        session.isSuperAdmin == true
      "
    >
      <input [(ngModel)]="channelName" name="channelName" type="input" />
      <button (click)="createChannel(group.group_name, session.username)">
        Create channel
      </button>
    </p>
  </li>
</ul>

<p></p>
